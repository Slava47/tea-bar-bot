<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Ли Бо</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="crm-layout">
        <aside class="sidebar">
            <div class="sidebar-brand">CRM Ли Бо</div>
            <nav class="sidebar-nav">
                <a href="{{ url_for('dashboard') }}" class="sidebar-link active">Дашборд</a>
                <a href="{{ url_for('export_data', fmt='csv') }}" class="sidebar-link">Экспорт CSV</a>
                <a href="{{ url_for('export_data', fmt='excel') }}" class="sidebar-link">Экспорт Excel</a>
            </nav>
            <div class="sidebar-footer">
                <a href="{{ url_for('logout') }}" class="sidebar-link sidebar-logout">Выход</a>
            </div>
        </aside>

        <main class="main-content">
            <header class="topbar">
                <h1 class="page-title">Дашборд</h1>
            </header>

            <div class="dashboard-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Пользователи</div>
                    <div class="kpi-value">{{ total_users }}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Подборы коктейлей</div>
                    <div class="kpi-value">{{ total_quizzes }}</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Оценки</div>
                    <div class="kpi-value">{{ total_ratings }}</div>
                </div>

            </div>

            <div class="panel-row">
                {% if top_cocktails %}
                <section class="panel panel-half">
                    <div class="panel-header">Популярные коктейли</div>
                    <div class="panel-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Коктейль</th>
                                    <th>Оценок</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for c in top_cocktails %}
                                <tr>
                                    <td>{{ c.cocktail_name }}</td>
                                    <td>{{ c.cnt }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </section>
                {% endif %}


            </div>

            <section class="panel">
                <div class="panel-header">
                    Пользователи
                    {% if total_users > display_limit %}
                    <span class="panel-hint">Показаны последние {{ display_limit }} из {{ total_users }}. <a href="{{ url_for('export_data', fmt='excel') }}">Скачать Excel</a> для полного списка.</span>
                    {% endif %}
                </div>
                <div class="panel-body">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Имя</th>
                                <th>Фамилия</th>
                                <th>Подборов</th>
                                <th>Дата регистрации</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for u in users %}
                            <tr>
                                <td><a href="{{ url_for('user_detail', user_id=u.user_id) }}">{{ u.user_id }}</a></td>
                                <td>{{ u.username or '-' }}</td>
                                <td>{{ u.first_name or '-' }}</td>
                                <td>{{ u.last_name or '-' }}</td>
                                <td>{{ u.quiz_count }}</td>
                                <td>{{ u.created_at }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>
</body>
</html>
